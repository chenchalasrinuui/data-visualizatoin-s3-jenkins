
pipeline {
    agent any

    environment {
        // Define environment variables, including Azure credentials
        AZURE_APP_NAME = 'MyReactApp'
        AZURE_PUBLISH_PROFILE = credentials('azure-publish-profile')
    }

    stages {
        stage('Checkout Code') {
            steps {
                // Clone the GitHub repository
                git branch: 'main', url: 'https://github.com/chenchalasrinuui/data-visualizatoin-s3-jenkins/.git'
            }
        }

        stage('Install Dependencies') {
            steps {
                // Install project dependencies
                bat 'npm install'
            }
        }

        stage('Build React App') {
            steps {
                // Build the React app for production
                bat 'npm run build'
            }
        }

        stage('Deploy to Azure') {
            steps {
                // Use Azure CLI or the Azure Web Apps Plugin to deploy to Azure
                withCredentials([file(credentialsId: 'azure-publish-profile', variable: 'PUBLISH_PROFILE')]) {
                    // Use Azure CLI for deployment
                    bat '''
                    az webapp deployment source config-zip \
                    --name $AZURE_APP_NAME \
                    --resource-group your-resource-group \
                    --src-path ./build.zip \
                    --slot production \
                    --publish-profile $PUBLISH_PROFILE
                    '''
                }
            }
        }
    }

    post {
        always {
            // Clean up
            cleanWs()
        }
    }
}
